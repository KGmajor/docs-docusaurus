"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9268],{24583:(e,i,a)=>{a.r(i),a.d(i,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>d});var n=a(11527),t=a(63883);const s={},o="Object Capabilities",r={id:"protocol/js-ceramic/accounts/object-capabilities",title:"Object Capabilities",description:"---",source:"@site/docs/protocol/js-ceramic/accounts/object-capabilities.md",sourceDirName:"protocol/js-ceramic/accounts",slug:"/protocol/js-ceramic/accounts/object-capabilities",permalink:"/docs/protocol/js-ceramic/accounts/object-capabilities",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"protocol",previous:{title:"Authorizations",permalink:"/docs/protocol/js-ceramic/accounts/authorizations"},next:{title:"Networking",permalink:"/docs/protocol/js-ceramic/networking/networking-index"}},c={},d=[{value:"Approach",id:"approach",level:2},{value:"Usage",id:"usage",level:2},{value:"Using blockchain accounts",id:"using-blockchain-accounts",level:3},{value:"Authorizing sessions",id:"authorizing-sessions",level:3},{value:"Specification",id:"specification",level:2},{value:"JWS with CACAO",id:"jws-with-cacao",level:3},{value:"DagJWS with CACAO",id:"dagjws-with-cacao",level:3},{value:"Construction",id:"construction",level:4},{value:"Verification",id:"verification",level:4},{value:"Example",id:"example",level:4}];function l(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h1,{id:"object-capabilities",children:"Object Capabilities"}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsxs)(i.p,{children:["Ceramic streams support ",(0,n.jsx)(i.a,{href:"https://chainagnostic.org/CAIPs/caip-74",children:"CACAO"}),', allowing a basic but powerful capability-based authorization system to exist. CACAO, or "chain agnostic object capabilities", are composable, transferable and verifiable containers for authorizations and encoded in IPLD.  For the full CACAO specification and more examples, reference ',(0,n.jsx)(i.a,{href:"https://chainagnostic.org/CAIPs/caip-74",children:"CAIP-74: CACAO - Chain Agnostic CApability Object"}),"."]}),"\n",(0,n.jsx)(i.h2,{id:"approach",children:"Approach"}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.p,{children:"Object capability-based authorization systems, of which CACAO is an implementation, are a natural way to represent authorizations in open and distributed systems. Object capabilities require little coordination, are only stored by parties that care about a particular capability, and are self-verifiable."}),"\n",(0,n.jsx)(i.p,{children:"Contrast this to popular authorization models like access controls lists (ACLs), which often rely on the ability to maintain an accurate, agreed-upon, and up to date list of authorizations. ACLs are simple and sufficient when you can rely on a single authoritative source to maintain the list, but quickly become difficult in a distributed setting. Maintaining a list amongst many unknown participants becomes a difficult consensus problem and often very costly at scale, requiring lots of upfront and continuous coordination."}),"\n",(0,n.jsx)(i.h2,{id:"usage",children:"Usage"}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.p,{children:"CACAO enables the ability for one account to authorize another account to construct signatures over limited data on their behalf, or in this case write to a Ceramic stream."}),"\n",(0,n.jsx)(i.h3,{id:"using-blockchain-accounts",children:"Using blockchain accounts"}),"\n",(0,n.jsxs)(i.p,{children:["When combined with ",(0,n.jsx)(i.a,{href:"https://chainagnostic.org/CAIPs/caip-122",children:'"Sign-in with X"'}),", CACAO unlocks the ability for blockchain accounts to authorize Ceramic accounts (DIDs) to sign data on their behalf."]}),"\n",(0,n.jsx)(i.p,{children:"This frequently used pattern in Ceramic greatly increases the the usability of user-owned data and public-key cryptography. Thanks to the adoption of blockchain based systems, many users now have the ability to easily sign data in web-based environments using their wallet and blockchain account."}),"\n",(0,n.jsx)(i.h3,{id:"authorizing-sessions",children:"Authorizing sessions"}),"\n",(0,n.jsx)(i.p,{children:'Data-centric systems like Ceramic often have more frequent writes than a blockchain system, so it can be impractical to sign every Ceramic stream event in a blockchain wallet. Instead with the use of CACAO and "Sign-in with X" many writes can be made by way of a temporary key and DID authorized with a CACAO. Allowing a user to only sign once with a blockchain based account and wallet, then continue to sign many payloads for an authorized amount of time (session).'}),"\n",(0,n.jsx)(i.admonition,{type:"note",children:(0,n.jsx)(i.p,{children:"In the future, we expect the ability to model the authorizations for more complex environments and structures including full organizations."})}),"\n",(0,n.jsx)(i.h2,{id:"specification",children:"Specification"}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsxs)(i.p,{children:["Support for object capabilities in the core Ceramic protocol is described below. Events in streams are signed payloads formatted in IPLD using DAGJWS (DAG-JOSE), as ",(0,n.jsx)(i.a,{href:"/docs/protocol/js-ceramic/streams/event-log",children:"described here"}),". This describes how this is extended to construct a valid signed payload using CACAO in DAGJWS, by example of first constructing a JWS with CACAO. A JWS with CACAO can then be directly encoded with DAG-JOSE after."]}),"\n",(0,n.jsx)(i.h3,{id:"jws-with-cacao",children:"JWS with CACAO"}),"\n",(0,n.jsxs)(i.p,{children:["JWS CACAO support includes adding a ",(0,n.jsx)(i.code,{children:"cap"})," parameter to the JWS Protected Header and specifying the correct ",(0,n.jsx)(i.code,{children:"kid"})," parameter string. Here is an example protected JWS header with CACAO:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:'{ \n  "alg": "EdDSA",\n  "cap": "ipfs://bafyreidoaclgf2ptbvflwalfrr6d4iqehkzyidwbzaouprdbjjfb4yim6q"\n  "kid": "did:key:z6MkrBdNdwUPnXDVD1DCxedzVVBpaGi8aSmoXFAeKNgtAer8#z6MkrBdNdwUPnXDVD1DCxedzVVBpaGi8aSmoXFAeKNgtAer8"\n }\n'})}),"\n",(0,n.jsx)(i.p,{children:"Where:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"alg"})," - identifies the cryptographic algorithm used to secure the JWS"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"cap"})," - maps to a URI string, expected to be an IPLD CID resolvable to a CACAO object"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"kid"})," - references the key used to secure the JWS. In the scope here this is expected to be a DID with reference to any key in the DID verification methods. The parameter MUST match the ",(0,n.jsx)(i.code,{children:"aud"})," target of the CACAO object for both the CACAO and corresponding signature to be valid together."]}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:["Since ",(0,n.jsx)(i.code,{children:"cap"}),' is currently not a registered header parameter name in the IANA "JSON Web Signature and Encryption Header Parameters" registry, we treat this as a "Private Header Parameter Name" for now with additional meaning provided by the CACAO for implementations that choose to use this specification.']}),"\n",(0,n.jsxs)(i.p,{children:["This means that ignoring the ",(0,n.jsx)(i.code,{children:"cap"})," header during validation will still result in a valid JWS payload by the key defined in the ",(0,n.jsx)(i.code,{children:"kid"}),". It just has no additional meaning by what is defined in the CACAO. The ",(0,n.jsx)(i.code,{children:"cap"})," header parameter could also have support added as an extension by using the ",(0,n.jsx)(i.code,{children:"crit"})," (Critical) Header Parameter in the JWS, but there is little reason to invalidate the JWS based on a consumer not understanding the ",(0,n.jsx)(i.code,{children:"cap"})," header given it is still valid."]}),"\n",(0,n.jsx)(i.h3,{id:"dagjws-with-cacao",children:"DagJWS with CACAO"}),"\n",(0,n.jsx)(i.h4,{id:"construction",children:"Construction"}),"\n",(0,n.jsx)(i.p,{children:"Given JWS with CACAO described in prior section, follow the DAG-JOSE specification and implementations for the steps to construct a given JWS with CACAO header and payload into a DagJWS. DagJWS is very similar to any JWS, except that the payload is a base64url encoded IPLD CID that references the JSON object payload."}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:'{ \n  cid: "bagcqcera2mews3mbbzs...quxj4bes7fujkms4kxhvqem2a",\n  value: {\n    jws: { \n      link: CID("bafyreidkjgg6bi4juwx...lb2usana7jvnmtyjb4xbgwl6e"),\n      payload: "AXESIGpJjeCjiaWv...LKw6pIDQfTVrJ4SHlwmsvx", \n      signatures: [\n        {\n          protected: "eyJhbGciOiJFZERTQSIsImNh...GU2djZEpLTmhYSDl4Rm9rdEFKaXlIQiJ9"\n          signature: "6usTYvu5KN0LFTQsWE9U-tqx...h60EgfvjL_rlAW7_tnQUl84sQyogpkLAQ"\n        }\n      ]\n    }\n  }\n}\n'})}),"\n",(0,n.jsx)(i.h4,{id:"verification",children:"Verification"}),"\n",(0,n.jsx)(i.p,{children:"The following algorithm describes the steps required to determine if a given DagJWS with CACAO is valid:"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsxs)(i.li,{children:["Follow ",(0,n.jsx)(i.a,{href:"https://ipld.io/specs/codecs/dag-jose/spec/",children:"DAG-JOSE specification"})," to transform a given DagJWS into a JWS."]}),"\n",(0,n.jsxs)(i.li,{children:["Follow JWS specifications to determine if the given JWS is valid. Verifying that the given signature paired with ",(0,n.jsx)(i.code,{children:"alg"})," and ",(0,n.jsx)(i.code,{children:"kid"})," in the protected header is valid over the given payload. If invalid, an error MUST be raised."]}),"\n",(0,n.jsxs)(i.li,{children:["Resolve the given URI in ",(0,n.jsx)(i.code,{children:"cap"})," parameter of the projected JWS header to a CACAO JSON object. Follow the ",(0,n.jsx)(i.a,{href:"https://chainagnostic.org/CAIPs/caip-74",children:"CAIP-74 CACAO"})," specification to determine if the given CACAO is valid. If invalid, an error MUST be raised."]}),"\n",(0,n.jsxs)(i.li,{children:["Ensure that the ",(0,n.jsx)(i.code,{children:"aud"})," parameter of the CACAO payload is the same target as the ",(0,n.jsx)(i.code,{children:"kid"})," parameter in the JWS protected header. If they do not match, an error MUST be raised."]}),"\n"]}),"\n",(0,n.jsx)(i.h4,{id:"example",children:"Example"}),"\n",(0,n.jsx)(i.p,{children:"Example IPLD dag-jose encoded block, strings abbreviated."}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:'{ \n  cid: "bagcqcera2mews3mbbzs...quxj4bes7fujkms4kxhvqem2a",\n  value: {\n    jws: { \n      link: CID("bafyreidkjgg6bi4juwx...lb2usana7jvnmtyjb4xbgwl6e"),\n      payload: "AXESIGpJjeCjiaWv...LKw6pIDQfTVrJ4SHlwmsvx", \n      signatures: [\n        {\n          protected: "eyJhbGciOiJFZERTQSIsImNh...GU2djZEpLTmhYSDl4Rm9rdEFKaXlIQiJ9"\n          signature: "6usTYvu5KN0LFTQsWE9U-tqx...h60EgfvjL_rlAW7_tnQUl84sQyogpkLAQ"\n        }\n      ]\n    }\n  }\n}\n'})}),"\n",(0,n.jsxs)(i.p,{children:["If ",(0,n.jsx)(i.code,{children:"block.value.jws.signatures[0].protected"})," is decoded, you would see the following object, a JWS protected header as described above:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:'{\n  "alg": "EdDSA",\n  "cap": "ipfs://bafyreidoaclgf...yidwbzaouprdbjjfb4yim6q",\n  "kid": "did:key:z6Mkq2ZyjGV54ev...hXH9xFoktAJiyHB#z6Mkq2ZyjGV54ev...hXH9xFoktAJiyHB"\n}\n'})})]})}function h(e={}){const{wrapper:i}={...(0,t.a)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},63883:(e,i,a)=>{a.d(i,{Z:()=>r,a:()=>o});var n=a(50959);const t={},s=n.createContext(t);function o(e){const i=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function r(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(s.Provider,{value:i},e.children)}}}]);