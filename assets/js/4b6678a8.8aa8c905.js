"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3281],{83727:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var i=t(11527),a=t(63883);const s={},r="Event Log",o={id:"protocol/js-ceramic/streams/event-log",title:"Event Log",description:"---",source:"@site/docs/protocol/js-ceramic/streams/event-log.md",sourceDirName:"protocol/js-ceramic/streams",slug:"/protocol/js-ceramic/streams/event-log",permalink:"/docs/protocol/js-ceramic/streams/event-log",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"protocol",previous:{title:"Streams",permalink:"/docs/protocol/js-ceramic/streams/streams-index"},next:{title:"URI Scheme",permalink:"/docs/protocol/js-ceramic/streams/uri-scheme"}},d={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Events",id:"events",level:2},{value:"Init Event",id:"init-event",level:3},{value:"Parameters defined as follows:",id:"parameters-defined-as-follows",level:4},{value:"Data Event",id:"data-event",level:3},{value:"Time Event",id:"time-event",level:3},{value:"Verification",id:"verification",level:2},{value:"Encoding",id:"encoding",level:2},{value:"JWS &amp; DAG-JOSE",id:"jws--dag-jose",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"event-log",children:"Event Log"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:"The core data structure in the Ceramic protocol is a self-certifying event log. It combines IPLD for hash linked data and cryptographic proofs to create an authenticated and immutable log. This event log can be used to model mutable databases and other data structures on top."}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:"Append-only logs are frequently used as an underlying immutable data structure in distributed systems to improve data integrity, consistency, performance, history, etc. Open distributed systems use hash linked lists/logs to allow others to verify the integrity of any data. IPLD provides a natural way to define an immutable append-only log."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Web3 authentication"})," - When combined with cryptographic signatures and blockchain timestamping, it allows authenticated writes to these logs using blockchain accounts and DIDs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Low cost decentralization"})," - Providing a common database layer for users and applications besides more expensive on-chain data or centralized and siloed databases"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Interoperability, flexibility, composability"})," - A minimally defined log structure allows a base level of interoperability while allowing diverse implementations of mutable databases and data structures on top. Base levels of interoperability include log transport, update syncing, consensus, etc."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"events",children:"Events"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:["Logs are made up of events. An init event originates a new log and is used to reference or name a log. The name of a stream is referred to as a ",(0,i.jsx)(n.a,{href:"/docs/protocol/js-ceramic/streams/uri-scheme#streamid",children:"StreamId"}),'. Every additional "update" is appended as a data event. Periodically, time events are added after one or more data events. Time events allow you to prove an event was published at or before some point in time using blockchain timestamping. They can also be used for ordering events within streams and for global ordering across streams and blockchain events. The minimal definition of a log is provided here, additional parameters in both the headers and body are defined at application level or by higher level protocols.']}),"\n",(0,i.jsxs)(n.p,{children:["Data events (and often Init Events) are signed DAGJWS and encoded in IPLD using the ",(0,i.jsx)(n.a,{href:"https://ipld.io/specs/codecs/dag-jose/spec/",children:"DAG-JOSE codec"}),". Event payloads are typically encoded as DAG-CBOR, but could be encoded with any codec supported by a node or the network. Formats and types are described using ",(0,i.jsx)(n.a,{href:"https://ipld.io/docs/schemas/",children:"IPLD schema language"})," and event encoding is further described below."]}),"\n",(0,i.jsx)(n.h3,{id:"init-event",children:"Init Event"}),"\n",(0,i.jsxs)(n.p,{children:["A log is initialized with an init event. The CID of this event is used to reference or name this log in a ",(0,i.jsx)(n.a,{href:"/docs/protocol/js-ceramic/streams/uri-scheme#streamid",children:"StreamId"}),". An init event may be signed or unsigned."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"\ntype InitHeader struct {\n  controllers [String]\n}\ntype InitPayload struct {\n  header InitHeader\n  data optional Any \n}\n\ntype InitJWS struct { // This is a DagJWS\n  payload String\n  signatures [Signature]\n  link: &InitPayload\n}\n\ntype InitEvent InitPayload | InitJWS\n\n"})}),"\n",(0,i.jsx)(n.h4,{id:"parameters-defined-as-follows",children:"Parameters defined as follows:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"controllers"})})," - an array of DID strings that defines which DIDs can write events to the log, when using CACAO, the DID is expected to be the issuer of the CACAO. Note that currently only a single DID is supported."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"data"})})," - data is anything, if defined the Init Event must match the InitJWS struct or envelope and be encoded in DAG-JOSE, otherwise the InitPayload would be a valid init event alone and encoded in DAG-CBOR"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"data-event",children:"Data Event"}),"\n",(0,i.jsx)(n.p,{children:"Log updates are data events. Data events are appended in the log to an init event, prior data events or a time event. A data event MUST be signed."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"type Event InitEvent | DataEvent | TimeEvent\n\ntype DataHeader struct {\n  controllers optional [String]\n}\n\ntype DataEventPayload struct {\n  id &InitEvent\n  prev &Event\n  header optional DataHeader\n  data Any \n}\n\ntype DataEvent struct { // This is a DagJWS\n  payload String\n  signatures [Signature]\n  link: &DataEventPayload\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Additional parameters defined as follows, controllers and data defined same as above."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"id"})})," - CID (Link) to the init event of the log"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"prev"})})," - CID (Link) to prior event in log"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"header"})})," - Optional header, included here only if changing header parameter value (controllers) from prior event. Other header values may be included outside this specification."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This being a minimally defined log on IPLD, later specifications or protocols can add additional parameters to both init and data events and their headers as needed."}),"\n",(0,i.jsx)(n.h3,{id:"time-event",children:"Time Event"}),"\n",(0,i.jsxs)(n.p,{children:["Time events can be appended to init events, and 1 or more data events. Reference ",(0,i.jsx)(n.a,{href:"https://chainagnostic.org/CAIPs/caip-168",children:"CAIP-168 IPLD Timestamp Proof"})," specification for more details on creating and verifying time events. Time Events are a simple extension of the IPLD Timestamp Proof specification, where ",(0,i.jsx)(n.code,{children:"prev"})," points to the prior event in the log and is expected to be the data for which the timestamp proof is for. A timestamp event is unsigned."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"type TimeEvent struct {\n  id &InitEvent\n  prev &DataEvent | &InitEvent\n  proof Link\n  path String\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"verification",children:"Verification"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:["A valid log is one that includes data events as defined above and traversing the log resolves to an originating init event as defined above. Each event is valid when it includes the required parameters above and the DAGJWS signature is valid for the given event ",(0,i.jsx)(n.code,{children:"controller"})," DID and valid as defined below. Time events are defined as valid by CAIP-168. There will likely be additional verification steps specific to any protocol or application level definition."]}),"\n",(0,i.jsx)(n.h2,{id:"encoding",children:"Encoding"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"jws--dag-jose",children:"JWS & DAG-JOSE"}),"\n",(0,i.jsxs)(n.p,{children:["All signed events are encoded in IPLD using ",(0,i.jsx)(n.a,{href:"https://ipld.io/specs/codecs/dag-jose/spec/",children:"DAG-JOSE"}),". DAG-JOSE is a codec and standard for encoding JOSE objects in IPLD. JOSE includes both",(0,i.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/rfc7515/?include_text=1",children:"JWS"})," for signed JSON objects and ",(0,i.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/rfc7516/?include_text=1",children:"JWE"})," for encrypted JSON objects. JWS is used for events here and is commonly used standard for signed data payloads. Some parameters are further defined for streams. The original DAG-JOSE specification can be found ",(0,i.jsx)(n.a,{href:"https://ipld.io/specs/codecs/dag-jose/spec/",children:"here"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"The following defines a general signed event, both init and data events are more specifically defined above."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"type Signature struct {\n  header optional { String : Any }\n  // The base64url encoded protected header, contains:\n  // `kid` - the DID URL used to sign the JWS\n  // `cap` - IPFS url of the CACAO used (optional)\n  protected optional String\n  signature String\n}\n\ntype EventJWS struct {\n  payload String\n  signatures [Signature]\n  link: &Event\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Where:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"link"})})," - CID (Link) to the event for which this signature is over. Provided for easy application access and IPLD traversal, expected to match CID encoded in payload"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"payload"})})," - base64url encoded CID link to the event (JWS payload) for which this signature is over"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"protected"})})," - base64 encoded JWS protected header"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"header"})})," - base64 encoded JWS header"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"signature"})})," - base64 encoded JWS signature"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},63883:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>r});var i=t(50959);const a={},s=i.createContext(a);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);