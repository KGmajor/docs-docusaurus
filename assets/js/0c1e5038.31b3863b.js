"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4559],{9613:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(9496);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=l(n),u=o,h=m["".concat(c,".").concat(u)]||m[u]||d[u]||r;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[m]="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8683:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var a=n(7605),o=(n(9496),n(9613));const r={},i="Running Ceramic in production",s={unversionedId:"protocol/js-ceramic/guides/ceramic-nodes/running-cloud",id:"protocol/js-ceramic/guides/ceramic-nodes/running-cloud",title:"Running Ceramic in production",description:"---",source:"@site/docs/protocol/js-ceramic/guides/ceramic-nodes/running-cloud.md",sourceDirName:"protocol/js-ceramic/guides/ceramic-nodes",slug:"/protocol/js-ceramic/guides/ceramic-nodes/running-cloud",permalink:"/docs-docusaurus/docs/protocol/js-ceramic/guides/ceramic-nodes/running-cloud",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"protocol",previous:{title:"Launch a local Ceramic node",permalink:"/docs-docusaurus/docs/protocol/js-ceramic/guides/ceramic-nodes/running-locally"},next:{title:"Ceramic HTTP client",permalink:"/docs-docusaurus/docs/protocol/js-ceramic/guides/ceramic-clients/javascript-clients/ceramic-http"}},c={},l=[{value:"Who should run a Ceramic node?",id:"who-should-run-a-ceramic-node",level:2},{value:"Things to know",id:"things-to-know",level:2},{value:"Required steps",id:"required-steps",level:2},{value:"Quick start",id:"quick-start",level:2},{value:"Run Ceramic on AWS ECS with Terraform \u2192",id:"run-ceramic-on-aws-ecs-with-terraform-",level:3},{value:"Running the daemon",id:"running-the-daemon",level:2},{value:"Run with Docker containers",id:"run-with-docker-containers",level:3},{value:"Run outside of containers",id:"run-outside-of-containers",level:3},{value:"Data Persistence",id:"data-persistence",level:2},{value:"IPFS Datastore",id:"ipfs-datastore",level:4},{value:"Ceramic State Store",id:"ceramic-state-store",level:4},{value:"Examples",id:"examples",level:2},{value:"Example with Docker containers",id:"example-with-docker-containers",level:3},{value:"Example without containers",id:"example-without-containers",level:3},{value:"Example daemon.config.json",id:"example-daemonconfigjson",level:3},{value:"Example AWS S3 Policies",id:"example-aws-s3-policies",level:3},{value:"Get connected to the network",id:"get-connected-to-the-network",level:2},{value:"Connecting to Ceramic",id:"connecting-to-ceramic",level:3},{value:"Staying connected to IPFS",id:"staying-connected-to-ipfs",level:3},{value:"Connect to the mainnnet anchor service",id:"connect-to-the-mainnnet-anchor-service",level:3},{value:"Observability",id:"observability",level:2},{value:"Next steps",id:"next-steps",level:2}],p={toc:l},m="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(m,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"running-ceramic-in-production"},"Running Ceramic in production"),(0,o.kt)("hr",null),(0,o.kt)("p",null,"This guide provides complete instructions and various tools for launching a well-connected, production-ready Ceramic node."),(0,o.kt)("h2",{id:"who-should-run-a-ceramic-node"},"Who should run a Ceramic node?"),(0,o.kt)("hr",null),(0,o.kt)("p",null,"To run your application on ",(0,o.kt)("inlineCode",{parentName:"p"},"mainnet")," you'll need to run your own production-ready node or to use a community provider like ",(0,o.kt)("a",{parentName:"p",href:"https://hirenodes.io/"},"hirenodes"),"."),(0,o.kt)("h2",{id:"things-to-know"},"Things to know"),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Ceramic networks")," \u2013 There are currently three Ceramic networks: ",(0,o.kt)("inlineCode",{parentName:"p"},"mainnet"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"testnet-clay"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"dev-unstable"),". Learn more about each network ",(0,o.kt)("a",{parentName:"p",href:"/docs-docusaurus/docs/protocol/js-ceramic/networking/networks"},"here"),". By default, Ceramic will connect to ",(0,o.kt)("inlineCode",{parentName:"p"},"testnet-clay")," and a ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ceramicnetwork/ceramic-anchor-service"},"Ceramic Anchor Service")," running on Gnosis. When you are ready to get on Ceramic ",(0,o.kt)("inlineCode",{parentName:"p"},"mainnet"),", check out ",(0,o.kt)("a",{parentName:"p",href:"../../../../composedb/guides/composedb-server/running-in-the-cloud"},"this guide")," to get access to our ",(0,o.kt)("inlineCode",{parentName:"p"},"mainnet")," anchor service."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Running IPFS")," \u2013 Ceramic relies on a system called ",(0,o.kt)("a",{parentName:"p",href:"https://docs.ipfs.io/"},"IPFS"),' to connect to and share data in Ceramic networks. IPFS runs as a separate process from the Ceramic node itself, with each Ceramic node connected to a dedicated IPFS node over HTTP. The Ceramic Daemon can launch an IPFS process automatically (referred to as running IPFS in "bundled" mode in the Ceramic config file), which is designed for testing and local development only. For production deployments you should run your own IPFS process manually and point your Ceramic node at it (referred to as running ipfs in "remote" mode in the Ceramic config file). This allows for more configuration options for your IPFS node allowing for more controlled resource allocation, as well as improved maintenance, debugging and observability. Note that Ceramic only supports ',(0,o.kt)("inlineCode",{parentName:"p"},"go-ipfs")," version 0.12 or later."),(0,o.kt)("p",null,'The rest of this guide assumes you are running Ceramic with IPFS in "remote" mode.'),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Process management, restarts and data persistence")," \u2013 Ceramic and IPFS will not automatically restart if they crash. You should configure your own restart mechanism, and you must ensure data persistence between restarts."),(0,o.kt)("h2",{id:"required-steps"},"Required steps"),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Below are the steps required for running a Ceramic node in production. This guide will teach you how to:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#running-the-daemon"},"Install and run the Ceramic daemon")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#data-persistence"},"Configure data persistence")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#get-connected-to-the-network"},"Get connected to the network")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#observability"},"Get observability data from your node (optional)"))),(0,o.kt)("h2",{id:"quick-start"},"Quick start"),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"run-ceramic-on-aws-ecs-with-terraform-"},(0,o.kt)("a",{parentName:"h3",href:"https://github.com/ceramicnetwork/terraform-aws-ceramic"},"Run Ceramic on AWS ECS with Terraform \u2192")),(0,o.kt)("p",null,"The 3Box Labs team has written a ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ceramicnetwork/terraform-aws-ceramic"},"Terraform module")," that configures Ceramic and IPFS in AWS ECS using Fargate. Using this module is a fast and reliable way to run Ceramic in the cloud because it is set up for data persistence and auto-restarts. The module currently requires some common AWS resources to be pre-configured as well as Cloudflare. See an ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ceramicnetwork/terraform-aws-ceramic/blob/main/examples/ecs/main.tf"},"example of the module in use"),"."),(0,o.kt)("p",null,"We highly encourage the community to create Terraform modules or other templates for different infrastructure providers to further decentralize the Ceramic network."),(0,o.kt)("h2",{id:"running-the-daemon"},"Running the daemon"),(0,o.kt)("hr",null),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ceramicnetwork/js-ceramic"},"js-ceramic")," node is run as a daemon using Node.js or Docker."),(0,o.kt)("p",null,"By default, the Ceramic daemon runs bundled with a ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ipfs/go-ipfs"},"go-ipfs")," node and connects to the Clay testnet and Gnosis ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ceramicnetwork/ceramic-anchor-service"},"Ceramic Anchor Service"),". In production, you should change these defaults to secure your data and accommodate your infrastructure setup."),(0,o.kt)("p",null,"The Ceramic daemon can be configured with a JSON file which is created on start and located at ",(0,o.kt)("inlineCode",{parentName:"p"},"$HOME/.ceramic/daemon.config.json")," by default (you can also point to a custom location for the config file using the ",(0,o.kt)("inlineCode",{parentName:"p"},"--config")," flag when starting the Ceramic Daemon). See ",(0,o.kt)("a",{parentName:"p",href:"#example-daemonconfigjson"},"example daemon.config.json")," below."),(0,o.kt)("h3",{id:"run-with-docker-containers"},"Run with Docker containers"),(0,o.kt)("p",null,"Docker images to run Ceramic and IPFS are built from the source code of the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ceramicnetwork/js-ceramic"},"js-ceramic")," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ceramicnetwork/go-ipfs-daemon"},"go-ipfs-daemon")," repositories respectively. Images built from the main branches are tagged with ",(0,o.kt)("inlineCode",{parentName:"p"},"latest")," and the git commit hash from which the image was built. You can view the image builds of ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/ceramicnetwork/js-ceramic"},"js-ceramic on DockerHub"),". The Docker image for ",(0,o.kt)("inlineCode",{parentName:"p"},"go-ipfs-daemon")," pre-configures IPFS with plugins that make it easy to run on cloud infrastructure. You can view the image builds for ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/ceramicnetwork/go-ipfs-daemon"},"go-ipfs-daemon on DockerHub"),"."),(0,o.kt)("h3",{id:"run-outside-of-containers"},"Run outside of containers"),(0,o.kt)("p",null,"If you would like to run Ceramic and IPFS outside of containers or on bare metal, start by installing ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ipfs/go-ipfs"},"go-ipfs")," (",(0,o.kt)("strong",{parentName:"p"},"version 0.12 or later"),"). Depending on your infrastructure setup you may consider building ",(0,o.kt)("inlineCode",{parentName:"p"},"go-ipfs")," with the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ceramicnetwork/go-ipfs-healthcheck"},"healthcheck plugin")," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/3box/go-ds-s3"},"S3 datastore plugin"),". Once IPFS is installed, configure it to use pubsub, which Ceramic relies on for message passing. This can be done by running the IPFS daemon with the ",(0,o.kt)("inlineCode",{parentName:"p"},"--enable-pubsub-experiment")," flag or modifying the configuration by running ",(0,o.kt)("inlineCode",{parentName:"p"},"ipfs config --json Pubsub.Enabled true")," (learn more in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ipfs/go-ipfs/blob/master/docs/experimental-features.md#ipfs-pubsub"},"IPFS docs"),"). Next you can run IPFS and install the Ceramic daemon with the ",(0,o.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@ceramicnetwork/cli"},"js-ceramic CLI"),", which is available as a public NPM module. It is currently compatible with ",(0,o.kt)("strong",{parentName:"p"},"Node.js versions 14 and 16.")),(0,o.kt)("h2",{id:"data-persistence"},"Data Persistence"),(0,o.kt)("p",null,"To run a Ceramic node in production, it is critical to persist the ",(0,o.kt)("a",{parentName:"p",href:"#ceramic-state-store"},"Ceramic state store")," and the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ipfs/go-ipfs/blob/master/docs/config.md#datastorespec"},"IPFS datastore"),". The form of storage you choose should also be configured for disaster recovery with data redundancy, and some form of snapshotting and/or backups."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Loss of this data can result in permanent loss of Ceramic streams and will cause your node to be in a corrupt state.")),(0,o.kt)("p",null,"The Ceramic state store and IPFS datastore are stored on your machine's filesystem by default. The Ceramic state store defaults to ",(0,o.kt)("inlineCode",{parentName:"p"},"$HOME/.ceramic/statestore"),". The IPFS datastore defaults to ",(0,o.kt)("inlineCode",{parentName:"p"},"ipfs/blocks")," located wherever you run IPFS."),(0,o.kt)("p",null,"The fastest way to ensure data persistence is by mounting a persistent volume to your instances and configuring the Ceramic and IPFS nodes to write to the mount location. The mounted volume should be configured such that the data persists if the instance shuts down."),(0,o.kt)("p",null,"You can also use AWS S3 for data storage which is supported for both Ceramic and IPFS. Examples of the configuration for both storage options are listed below."),(0,o.kt)("h4",{id:"ipfs-datastore"},"IPFS Datastore"),(0,o.kt)("p",null,"The IPFS datastore stores the raw IPFS blocks that make up Ceramic streams. To prevent data corruption, use environment variables written to your profile file, or otherwise injected into your environment on start so that the datastore location does not change between reboots."),(0,o.kt)("p",null,"Note: Switching between data storage locations is an advanced feature and should be avoided. Depending on the sharding implementation you may need to do a data migration first. See ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ipfs/go-ipfs/blob/master/docs/config.md#datastorespec"},"https://github.com/ipfs/go-ipfs/blob/master/docs/config.md#datastorespec")," for more information."),(0,o.kt)("h4",{id:"ceramic-state-store"},"Ceramic State Store"),(0,o.kt)("p",null,"The Ceramic state store holds state for pinned streams and the acts as a cache for the Ceramic streams that your node creates or loads. To ensure that the data you create with your Ceramic node does not get lost you must pin streams you care about and you must ensure that the state store does not get deleted."),(0,o.kt)("h2",{id:"examples"},"Examples"),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"example-with-docker-containers"},"Example with Docker containers"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull ceramicnetwork/go-ipfs-daemon:latest\n\n# Use this snippet to keep the datastore in the volume\ndocker run \\\n  -p 5001:5001 \\ # API port\n  -p 8011:8011 \\ # Healthcheck port\n  -v /path_on_volume_for_ipfs_repo:/data/ipfs \\\n  --name ipfs \\\n  go-ipfs-daemon\n\n# Use this snippet to keep the datastore in S3\ndocker run \\\n  -p 5001:5001 \\ # API port\n  -p 8011:8011 \\ # Healthcheck port\n  -v /path_on_volume_for_ipfs_repo:/data/ipfs \\\n  -e IPFS_ENABLE_S3=true \\\n  -e IPFS_S3_REGION=region \\\n  -e IPFS_S3_BUCKET_NAME=bucket_name \\\n  -e IPFS_S3_ROOT_DIRECTORY=root_directory \\\n  -e IPFS_S3_ACCESS_KEY_ID=aws_access_key_id \\\n  -e IPFS_S3_SECRET_ACCESS_KEY=aws_secret_access_key \\\n  -e IPFS_S3_KEY_TRANSFORM=next-to-last/2 \\ # Sharding method\n  --name ipfs \\\n  go-ipfs-daemon\n\n# Get the IP address\ndocker inspect -f \\\n  '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' \\\n  ipfs\n")),(0,o.kt)("p",null,'Before running the Ceramic daemon, configure it to use IPFS in "remote" mode. See ',(0,o.kt)("a",{parentName:"p",href:"#example-daemonconfigjson"},"example daemon.config.json")," below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull ceramicnetwork/js-ceramic:latest\n\n# Use this snippet to keep the statestore in a volume\ndocker run -d \\\n  -p 7007:7007 \\\n  -v /path_on_volume_for_daemon_config:/root/.ceramic/daemon.config.json \\\n  -v /path_on_volume_for_ceramic_logs:/root/.ceramic/logs \\\n  -v /path_on_volume_for_ceramic_statestore:/root/.ceramic/statestore \\\n  -e NODE_ENV=production \\\n  --name js-ceramic \\\n  ceramicnetwork/js-ceramic:latest\n\n# Use this snippet to keep the statestore in S3\ndocker run -d \\\n  -p 7007:7007 \\\n  -v /path_for_daemon_config:/root/.ceramic/daemon.config.json \\\n  -v /path_for_ceramic_logs:/root/.ceramic/logs \\\n  -e NODE_ENV=production \\\n  -e AWS_ACCESS_KEY_ID=s3_access_key_id \\\n  -e AWS_SECRET_ACCESS_KEY=s3_secret_access_key \\\n  --name js-ceramic \\\n  ceramicnetwork/js-ceramic:latest\n")),(0,o.kt)("h3",{id:"example-without-containers"},"Example without containers"),(0,o.kt)("p",null,"After installation, both daemons can be run from the command line"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"ipfs init\nipfs daemon\n")),(0,o.kt)("p",null,'Before running the Ceramic daemon, configure it to use IPFS in "remote" mode. See ',(0,o.kt)("a",{parentName:"p",href:"#example-daemonconfigjson"},"example daemon.config.json")," below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"ceramic daemon\n")),(0,o.kt)("h3",{id:"example-daemonconfigjson"},"Example daemon.config.json"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "anchor": {\n        "ethereum-rpc-url": "https://eg_infura_endpoint" // Replace with an Ethereum RPC endpoint to avoid rate limiting\n    },\n    "http-api": {\n        "cors-allowed-origins": [\n            ".*"\n        ]\n    },\n    "ipfs": {\n        "mode": "remote",\n        "host": "http://ipfs_ip_address:5001"\n    },\n    "logger": {\n        "log-level": 2, // 0 is most verbose\n        "log-to-files": true\n    },\n    "network": {\n        "name": "mainnet", // Connect to mainnet, testnet-clay, or dev-unstable\n    },\n    "node": {},\n    "state-store": {\n        "mode": "s3",\n        "s3-bucket": "bucket_name"\n    }\n}\n')),(0,o.kt)("p",null,"To use volume storage for the statestore instead of S3"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'"state-store": {\n    "mode": "fs",\n    "local-directory": "/path_for_ceramic_statestore", // Defaults to $HOME/.ceramic/statestore\n}\n')),(0,o.kt)("h3",{id:"example-aws-s3-policies"},"Example AWS S3 Policies"),(0,o.kt)("p",null,"IPFS AWS S3 policy for the access key"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Action": [\n        "s3:GetObject",\n        "s3:ListBucket",\n        "s3:PutObject",\n        "s3:DeleteObject"\n      ],\n      "Effect": "Allow",\n      "Resource": ["ipfs_bucket_arn", "ipfs_bucket_arn/*"]\n    }\n  ]\n}\n')),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre"},"The [S3 datastore](https://github.com/3box/go-ds-s3) is not available out-of-the-box in vanilla `go-ipfs`. In order to use it with minimal configuration, use the 3Box Labs [go-ipfs-daemon](https://github.com/ceramicnetwork/go-ipfs-daemon).\n"))),(0,o.kt)("p",null,"Ceramic state store AWS S3 policy for the access key"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Action": [\n        "s3:ListBucket",\n        "s3:GetObject",\n        "s3:PutObject",\n        "s3:DeleteObject"\n      ],\n      "Effect": "Allow",\n      "Resource": ["state_store_bucket_arn", "state_store_bucket_arn/*"]\n    }\n  ]\n}\n')),(0,o.kt)("h2",{id:"get-connected-to-the-network"},"Get connected to the network"),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"connecting-to-ceramic"},"Connecting to Ceramic"),(0,o.kt)("p",null,"The Ceramic daemon serves an HTTP API that clients use to interact with your Ceramic node. The default API port is ",(0,o.kt)("inlineCode",{parentName:"p"},"7007"),". Make sure this port is available to all clients you plan to use for your application."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre"},"Healthchecks can be run against the API endpoint `/api/v0/node/healthcheck`.\n"))),(0,o.kt)("h3",{id:"staying-connected-to-ipfs"},"Staying connected to IPFS"),(0,o.kt)("p",null,'Ceramic nodes rely on IPFS for networking. IPFS nodes connect to each other using a Libp2p module called "switch" (aka "swarm"). This module operates over a websocket, on port ',(0,o.kt)("inlineCode",{parentName:"p"},"4011")," by default. The websocket port must be accessible to the internet so your Ceramic node can be connected to the network."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre"},"Healthchecks can be run against the `HEALTHCHECK_PORT` (port `8011` by default) when `HEALTHCHECK_ENABLED` is `true`.\n"))),(0,o.kt)("p",null,"Additionally, when running IPFS the IPFS API port must be accessible by the Ceramic node. The default API port is ",(0,o.kt)("inlineCode",{parentName:"p"},"5001"),". The IPFS node address will then be passed to Ceramic with the ",(0,o.kt)("inlineCode",{parentName:"p"},"ipfs.host")," option in the Ceramic daemon config file."),(0,o.kt)("h3",{id:"connect-to-the-mainnnet-anchor-service"},"Connect to the mainnnet anchor service"),(0,o.kt)("p",null,"For nodes that wish to connect to Ceramic mainnet, the node's IP address will have to be added to the allowlist for the Ceramic Anchor Service node operated by 3BoxLabs. Once you have fully configured your Ceramic node with this guide and have a way to persist its configuration and state, open an issue in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/3box/ceramic-anchor-allowlist"},"Ceramic Anchor Allowlist Repo")," with the public, static ",(0,o.kt)("em",{parentName:"p"},"egress")," IP address for your Ceramic node, and a brief description of the data persistence setup for the multiaddress, Ceramic State Store, and IPFS Repo. Once your issue is closed, you will be connected to the Ceramic network and the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ceramicnetwork/ceramic-anchor-service"},"Ceramic Anchor Service"),"."),(0,o.kt)("p",null,"Nodes that wish to connect to other Ceramic networks, such as the clay testnet, do not need to do anything special to gain access to the Ceramic Anchor Service.  The Anchor Service for the ",(0,o.kt)("inlineCode",{parentName:"p"},"testnet-clay")," network is open to everyone and does not have an IP allowlist like the mainnet service does."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre"},"Mainnet nodes will not run immediately after start up until your pull request is reviewed and your IP address is added to the allow list for the 3Box Labs hosted anchor service.\n"))),(0,o.kt)("h2",{id:"observability"},"Observability"),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Ceramic has a debug mode that you can enable using the ",(0,o.kt)("inlineCode",{parentName:"p"},"--debug")," flag. This will allow you to see all logs printed to your console, including debug logs, API requests, events, and errors."),(0,o.kt)("p",null,"For observability, it is best to have these logs written to files to debug any issues and to generate metrics. Logging to files can be enabled with the ",(0,o.kt)("inlineCode",{parentName:"p"},"logger.log-to-files")," config file option. The default location for logs is ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.ceramic/logs")," but this path can be configured with the ",(0,o.kt)("inlineCode",{parentName:"p"},"logger.log-directory")," config file option. Even without debug mode enabled you will still get critical logs and metrics written to files."),(0,o.kt)("p",null,"Request and event logs are written in ",(0,o.kt)("a",{parentName:"p",href:"https://brandur.org/logfmt"},"logfmt"),". This makes them easy to import into ",(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/"},"Grafana")," dashboards using a log scraping agent like ",(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/docs/loki/latest/clients/promtail/"},"Promtail")," and a log aggregator like ",(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/docs/loki/latest/"},"Loki"),", which can be used as a data source for Grafana. An example of such a setup can be found ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/3box/ceramic-stats"},"here"),"."),(0,o.kt)("h2",{id:"next-steps"},"Next steps"),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Congratulations! You have now set up a well-connected Ceramic node in the cloud which can receive HTTP requests from the local environment, the ",(0,o.kt)("a",{parentName:"p",href:"/docs-docusaurus/docs/protocol/js-ceramic/guides/ceramic-clients/javascript-clients/ceramic-http"},"JS HTTP Client"),", or to simply serve as another node to replicate and pin streams. Please report any bugs as issues on the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ceramicnetwork/js-ceramic"},"JS Ceramic GitHub"),"."))}d.isMDXComponent=!0}}]);